#include<iostream>
#include <windows.h>
#include<conio.h>
#include <stdio.h>
using namespace std;


struct stack{
	int x;
	int y;
	stack *next;
};

stack *top=NULL;

void push(stack **top, int x1, int y1){
	stack *ex;
	ex = new stack();
	ex->x=x1;
	ex->y=y1;
	if(top==NULL){
		*top=ex;
	}
	else{
		ex->next=*top;
		*top=ex;	
	}	
}

void delast(stack **top){
	stack *ex=*top;
	stack *prev=NULL;
	while(ex){
		if(ex->next==NULL){
			ex->next=NULL;
			ex->x=NULL;
			ex->y=NULL;
			prev->next=NULL;
		}
		prev=ex;
		ex=ex->next;	
	}
}

int num(stack **top){
	stack *ex=*top;
	int numb=0;
	while(ex){
		++numb;
		ex=ex->next;	
	}
	return numb;
}



unsigned int size_of_field=20, chetchik=0, snakecount=1, grantbuf=0;
const char snake='#', bort='*';
const int w=56, a=52, s=50, d=54;
int x, y, last[2];

void ex(){
	cout<<"asinc away\nasinc away\nasinc away\nasinc away\n";
	exit(0);
}
void sett(){
	char accept;
	cout<<"Size of field: "<< size_of_field <<"x"<<size_of_field*2<<" \nDo you want change? (Y/N)\n";
	accept=getch();
	if(accept=='Y' || accept== 'y'){
		cout<<"Input new size:";
		cin>>size_of_field;
		if(size_of_field*2<20)size_of_field=20;
		else if(size_of_field*2>255)size_of_field=255;
		else cout<<endl<<endl<<"Compliete!";	
	}
}

void star(){
	x=size_of_field;
	y=size_of_field/2;
	bool live=true;
	char mass[size_of_field][size_of_field*2], t=56;
	int snakelen=100;
	int i, j;
	for(j=0;j<size_of_field;j++)
		for(i=0;i<size_of_field*2;i++){
			mass[j][i]=' ';
		}
			
	
	
	for(j=0;j<size_of_field*2;j++)mass[0][j]='*';
	for(i=0;i<size_of_field;i++){
		cout<<endl;
		mass[i][0]='*';
		mass[i][size_of_field*2-1]='*';
	}
	for(j=0;j<size_of_field*2;j++)mass[size_of_field-1][j]='*';
	
	for(j=0;j<size_of_field;j++){
		for(i=0;i<size_of_field*2;i++){
			cout<<mass[j][i];
		}
		cout<<endl;
	}
	push(&top,x,y);	
	while(live){
		
		for(j=1;j<size_of_field-1;j++)
		for(i=1;i<size_of_field*2-1;i++)
			mass[j][i]=' ';
		
		if(kbhit()) t=getch();
			switch((int)t){
				case w: --y; break;
				case a: --x; break;
				case s: ++y; break;
				case d: ++x; break;
				default: --y; break;
		}
		if(mass[y][x]!=snake && mass[y][x]!=bort){
//			push(&top,x,y);	
			while(num(&top)>snakelen){
				delast(&top);
			}
		}
		else live=false;
		
		system("cls");
	
		stack *ex=top;
		for(j=0;j<size_of_field;j++)
			for(i=0;i<size_of_field*2;i++){
				while(ex){		
					ex=ex->next;
					if(i==ex->x && j==ex->y){
						mass[j][i]=snake;
					}	
				}
			}

			for(j=0;j<size_of_field;j++){
				for(i=0;i<size_of_field*2;i++){
					cout<<mass[j][i];
				}
				cout<<endl;		
			}
	
		
	//field(&top,mass);
		//++chetchik;
		Sleep(100);	
	//	if (chetchik%5==0)snakelen++;
	}	
}




void menu(string s=""){
	cout<<s;
	
	int i, j, y=20;
	char a, mass[y][y], start[6]={'>','S','t','a','r','t'}, settings[9]={' ','S','e','t','t','i','n','g','s'}, exit[5]={' ','E','x','i','t'};
	for(i=0;i<y;i++)
		for(j=0;j<y;j++){
			mass[i][j]=' ';
		}
	
	
	while(true){
		for(i=0;i<6;i++)mass[3][i+2]=start[i];
		for(i=0;i<9;i++)mass[4][i+2]=settings[i];
		for(i=0;i<5;i++)mass[5][i+2]=exit[i];
		for(i=0;i<10;i++){
			for(j=0;j<y;j++){
				cout<<mass[i][j];
			}
		cout<<endl;
		}
		a=getch();
		switch((int)a){
			case 50: 
				if(start[0]=='>'){start[0]=' '; settings[0]='>';}
				else if(settings[0]=='>'){settings[0]=' '; exit[0]='>';}
				else if(exit[0]=='>'){start[0]='>'; exit[0]=' ';} break;
			case 56: 
				if(start[0]=='>'){start[0]=' '; exit[0]='>';}
				else if(settings[0]=='>'){settings[0]=' '; start[0]='>';}
				else if(exit[0]=='>'){settings[0]='>'; exit[0]=' ';} break;
			case 13: 
				if(start[0]=='>') star(); 
				else if(settings[0]=='>')sett();
				else if(exit[0]=='>')ex(); break;
			default: cout<<endl<<"Use NumLock - 8 and 2 pls!";  break;
		}
		system ("cls");
	}
}

int main(){
menu();
	
	
	
}
